# 接口文档
路径： http://119.29.189.246:6000/

请求数据类型统一为：`'Content-Type': 'application/json; charset=UTF-8'`

## 登录

### 路径

相对路径：'/login'  
请求方法: post

### 携带body

```json
{
    account: '',
    passwrod: '',
}
```



### 返回body

```json
{
    "loginStatus": true,
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjoiMTAwMDAiLCJpYXQiOjE2MjM3Mzc4MTAsImV4cCI6MTYyMzczOTYxMH0.iapuwnvhC1yiW8RS1FBSb0CDGCpMdOqNLRn--h0IEDw",
    "applyRecords": [],
    "groups": [
        [
            {
                "account": 10000,
                "name": "我",
                "lastword": "g测试连接2",
                "signature": null,
                "groupIndex": 1,
              	"loginStatus": 0 || 1,
            },
            {
                "account": 10001,
                "name": "二傻子",
                "lastword": "s测试未读计数2",
                "signature": null,
                "groupIndex": 1
            },
            {
                "account": 10002,
                "name": "三傻子",
                "lastword": "g我是会走的人",
                "signature": null,
                "groupIndex": 1
            }
        ],
        [
            {
                "account": 10003,
                "name": "聪明人",
                "lastword": "s你是？",
                "signature": null,
                "groupIndex": 2
            },
            {
                "account": 10086,
                "name": "linerlin",
                "lastword": "",
                "signature": "这个人很懒,什么都没留下",
                "groupIndex": 2
            }
        ],
        [],
        [],
        []
    ],
    "account": "10000",
    "name": "会飞的鸟",
    "word": "测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试",
    "groupNames": [
        "好友",
        "同学",
        "我的同学",
        "我的同事",
        "黑名单"
    ]
}
```



1. token，以后每次请求必须将该字段放到header的`Authorization`字段中。

2. name(网名)

3. applyRecord是所有的好友申请记录。

   > [
   >
   > ​	[
   >
   > ​	account
   >
   > ​	name
   >
   > ​	accept
   >
   > ​	lastword
   >
   > ​	signature
   >
   > ​	],
   >
   > ]

4. groups(好友列表)，依次序是

   > ```javascript
   >  "groups": [
   >         [
   >             {
   >                 "account": 10000,
   >                 "name": "我",
   >                 "lastword": "g测试连接2",
   >                 "signature": null,
   >                 "groupIndex": 1
   >             },
   >             {
   >                 "account": 10001,
   >                 "name": "二傻子",
   >                 "lastword": "s测试未读计数2",
   >                 "signature": null,
   >                 "groupIndex": 1
   >             },
   >             {
   >                 "account": 10002,
   >                 "name": "三傻子",
   >                 "lastword": "g我是会走的人",
   >                 "signature": null,
   >                 "groupIndex": 1
   >             }
   >         ],
   >         [
   >             {
   >                 "account": 10003,
   >                 "name": "聪明人",
   >                 "lastword": "s你是？",
   >                 "signature": null,
   >                 "groupIndex": 2
   >             },
   >             {
   >                 "account": 10086,
   >                 "name": "linerlin",
   >                 "lastword": "",
   >                 "signature": "这个人很懒,什么都没留下",
   >                 "groupIndex": 2
   >             }
   >         ],
   >         [],
   >         [],
   >         []
   >     ],
   > ```

5. loginStatus (布尔值)

6. groupNames就是好友列表的名字，里面的成员依次对照groups。

## 登录刷新

### 路径

`/login`, 方法是`get`

### 请求字段

`header`中的`Authorization`字段中的token值。

### 响应报文

#### 验证失败

返回1就是，token无效，2就是token过期

#### 验证成功

```json
{
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjoiMTAwMDAiLCJpYXQiOjE2MjM3Mzg1MDYsImV4cCI6MTYyMzc0MDMwNn0.ZftPcOQzPAkI5iEErPlK7N7cE-57R9KYcV7M3T4xHFQ",
    "groups": [
        [
            {
                "account": 10000,
                "name": "我",
                "lastword": "g测试连接2",
                "signature": null,
                "groupIndex": 1
            },
            {
                "account": 10001,
                "name": "二傻子",
                "lastword": "s测试未读计数2",
                "signature": null,
                "groupIndex": 1
            },
            {
                "account": 10002,
                "name": "三傻子",
                "lastword": "g我是会走的人",
                "signature": null,
                "groupIndex": 1
            }
        ],
        [
            {
                "account": 10003,
                "name": "聪明人",
                "lastword": "s你是？",
                "signature": null,
                "groupIndex": 2
            },
            {
                "account": 10086,
                "name": "linerlin",
                "lastword": "",
                "signature": "这个人很懒,什么都没留下",
                "groupIndex": 2
            }
        ],
        [],
        [],
        []
    ],
    "applyRecords": [],
    "account": "10000",
    "name": "会飞的鸟",
    "word": "测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试",
    "groupNames": [
        "好友",
        "同学",
        "我的同学",
        "我的同事",
        "黑名单"
    ]
}
```



## 添加好友

### 基本路径

`/friendship`

### 发起申请

#### 路径

`/apply`，方法是`post`

#### 请求报文应该携带

```javascript
{
    account（本人账号）:
    addAccount（要添加的人的账号）:
    name:
    addName:
    group（分组序号）:
    signature（申请人签名）:
    friendSignature（被申请人的个性签名）:
}
```

#### 响应报文

```json
{
    addStatus: true || false // 判断是否添加成功
}
```

### 处理好友申请

#### 路径

`handle`， 方法`post`

#### 请求报文

```json
{
    account:
    addAccount:
    type(处理类型): 1是接受，0是拒绝
    options(同意添加才需要携带): {
        groupIndex:
    }
}

```

#### 响应报文

无

### 搜索好友

#### 路径

`/search`， 方法是`get`

#### 请求头

携带查询字符串，含有account字段

#### 响应报文

```json
{
    searchResult: true || false,
    name:
    word:
    account:
    loginStatus:
}
```

## 聊天记录

### 基本路径

`/message`

### 获取聊天记录

#### 路径和方法

路径：`/`,方法：`get`

#### 请求携带查询字符串

```javascript
{
	fromaccount: 必须
    findaccount:必须
    uid：可选
}
```

#### 返回

```json
[
    {
        "friendaccount": 10001,
        "word": "g测试发送2",
        "isSend": 0,
        "datetime": "2021-04-08T22:19:46.000Z"
        "uid": 
    }
]
```



## socket连接

地址后缀：`/chat`

### 第一次连接

添加查询字符串,`account`和`device`，0 is phone, 1 is pc。

### 客户端接受事件

#### OTHER_DEVICE_LOGIN

号被挤了。

#### LOGIN_IN_PHONE_PC

比如说，手机登陆，就通知电脑，手机登陆了。

#### FRIEND_ONLINE

好友上线了

```json
data: {
  account,
  device,
}
```

#### PRIVATE_CHAT_SEND_OTHER_DEVICE

比如说，手机和电脑都登陆，电脑发消息，这个就是手机同步这条消息。

```json
data: {
  toAccount,
  message,
  sendTime,
}
```

#### PRIVATE_CHAT_RECEIVE

接受信息

```json
data: {
  fromAccount,
  message,
  receiveTime,
}
```

#### FRIEND_ONLINE

好友上线通知

```json
data: {
    account,
    device,
}
```

#### FRIEND_OFFLINE

好友离线通知

```json
data: {
    account,
    device,
}
```



#### *RECEIVE_FRIEND_APPLY*

收到好友申请

```json
          data: {
            fromAccount: account,
            fromName: name,
            fromSignature: signature,
          },
```

#### *RECEIVE_FRIEND_APPLY_RESULT*

收到好友申请结果

```json
        data: {
          fromAccount: account,
          result: type,
        },
```



### 客户端触发事件

#### PRIVATE_CHAT_SEND

```json
data: {
  fromAccount,
  toAccount,
  message,
  device,
}
```

